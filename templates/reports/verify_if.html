{% extends 'base.html' %}

{% block title %}Verify Impact Factors - Academic Achievement Summarizer{% endblock %}

{% block page_title %}Verify Impact Factors{% endblock %}

{% block extra_css %}
<style>
    .summary-cards {
        display: flex;
        gap: 20px;
        margin-bottom: 25px;
    }
    .summary-card {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 15px 25px;
        text-align: center;
    }
    .summary-card.flagged {
        background: #fff3cd;
        border-color: #ffc107;
    }
    .summary-value {
        font-size: 28px;
        font-weight: bold;
        color: #2c3e50;
    }
    .summary-card.flagged .summary-value {
        color: #856404;
    }
    .summary-label {
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
    }
    .pub-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }
    .pub-table th {
        background: #34495e;
        color: white;
        padding: 12px 10px;
        text-align: left;
        font-weight: 500;
    }
    .pub-table td {
        padding: 10px;
        border-bottom: 1px solid #eee;
        vertical-align: top;
    }
    .pub-table tr:hover {
        background: #f8f9fa;
    }
    .pub-table tr.flagged {
        background: #fff3cd;
    }
    .pub-table tr.flagged:hover {
        background: #ffe69c;
    }
    .flag-badge {
        background: #dc3545;
        color: white;
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 11px;
        font-weight: 600;
    }
    .ok-badge {
        background: #28a745;
        color: white;
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 11px;
    }
    .if-value {
        font-weight: 600;
        font-size: 15px;
    }
    .if-value.reported {
        color: #2c3e50;
    }
    .if-value.openalex {
        color: #3498db;
    }
    .difference {
        font-weight: 600;
    }
    .difference.positive {
        color: #dc3545;
    }
    .difference.negative {
        color: #28a745;
    }
    .difference.neutral {
        color: #666;
    }
    .journal-name {
        font-weight: 500;
        color: #2c3e50;
    }
    .pub-title {
        color: #666;
        font-size: 12px;
        margin-top: 3px;
    }
    .doi-link {
        font-size: 11px;
        color: #3498db;
    }
    .points-badge {
        background: #27ae60;
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-weight: 500;
    }
    .no-data {
        text-align: center;
        padding: 40px;
        color: #666;
        background: #f8f9fa;
        border-radius: 5px;
    }
    .info-box {
        background: #e7f3ff;
        border: 1px solid #b8daff;
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 20px;
        font-size: 14px;
    }
    .info-box strong {
        color: #004085;
    }
</style>
{% endblock %}

{% block content %}
<div class="info-box">
    <strong>How this works:</strong> DOIs are looked up via CrossRef to get the journal name,
    then OpenAlex provides "2-year mean citedness" (similar to Impact Factor).
    Publications are flagged if the difference between reported and OpenAlex values is 2 or more.
</div>

<div class="summary-cards">
    <div class="summary-card">
        <div class="summary-value">{{ total_count }}</div>
        <div class="summary-label">Publications</div>
    </div>
    <div class="summary-card">
        <div class="summary-value">{{ successful_lookups }}</div>
        <div class="summary-label">DOI Lookups</div>
    </div>
    <div class="summary-card flagged">
        <div class="summary-value">{{ flagged_count }}</div>
        <div class="summary-label">Flagged (diff &ge; 2)</div>
    </div>
</div>

{% if publications %}
<table class="pub-table">
    <thead>
        <tr>
            <th style="width: 15%;">Faculty</th>
            <th style="width: 25%;">Journal / Title</th>
            <th style="width: 12%;">Reported IF</th>
            <th style="width: 12%;">OpenAlex</th>
            <th style="width: 10%;">Difference</th>
            <th style="width: 10%;">Points</th>
            <th style="width: 8%;">Status</th>
        </tr>
    </thead>
    <tbody>
        {% for pub in publications %}
        <tr class="{% if pub.flagged %}flagged{% endif %}">
            <td>
                <a href="{% url 'faculty_detail' pub.faculty_email %}">{{ pub.faculty_name }}</a>
            </td>
            <td>
                <div class="journal-name">{{ pub.journal_reported }}</div>
                <div class="pub-title">{{ pub.title }}...</div>
                {% if pub.doi %}
                <a href="https://doi.org/{{ pub.doi }}" target="_blank" class="doi-link">{{ pub.doi }}</a>
                {% endif %}
            </td>
            <td>
                <span class="if-value reported">{{ pub.reported_if }}</span>
            </td>
            <td>
                {% if pub.openalex_if %}
                <span class="if-value openalex">{{ pub.openalex_if }}</span>
                {% else %}
                <span style="color: #999;">N/A</span>
                {% endif %}
            </td>
            <td>
                {% if pub.difference is not None %}
                <span class="difference {% if pub.difference > 0 %}positive{% elif pub.difference < 0 %}negative{% else %}neutral{% endif %}">
                    {% if pub.difference > 0 %}+{% endif %}{{ pub.difference }}
                </span>
                {% else %}
                <span style="color: #999;">-</span>
                {% endif %}
            </td>
            <td>
                <span class="points-badge">{{ pub.points }}</span>
            </td>
            <td>
                {% if pub.flagged %}
                <span class="flag-badge">REVIEW</span>
                {% elif pub.lookup_success %}
                <span class="ok-badge">OK</span>
                {% else %}
                <span style="color: #999;">-</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="no-data">
    No publications with DOIs found.<br>
    <a href="{% url 'import_survey' %}">Import survey data</a> to add publications.
</div>
{% endif %}

<p style="margin-top: 20px; color: #666; font-size: 13px;">
    <strong>Note:</strong> OpenAlex "2-year mean citedness" is similar but not identical to Clarivate Impact Factor.
    Use this as a guide for review, not as definitive values.
</p>
{% endblock %}
